<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Heart Health Monitoring Signup</title>
  <!-- Link to Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Custom button color from the uploaded logo */
  .btn-custom {
    background-color: rgb(90, 150, 210); /* Darker blue color */
    border-color: rgb(90, 150, 210);
    font-size: 16px;
    padding: 10px 20px;
    width: 100%;
    border-radius: 8px;
    cursor: not-allowed; /* Default cursor when disabled */
  }

  .btn-custom:hover {
    background-color: rgb(98, 157, 189);
    border-color: rgb(98, 157, 189);
  }

  /* Style for the submit button when it's disabled */
  .btn-custom:disabled {
    background-color: rgb(160, 190, 230); /* Lighter blue to indicate disabled state */
    border-color: rgb(160, 190, 230);
    cursor: not-allowed; /* Ensure the cursor stays as "not-allowed" */
    opacity: 0.7; /* Slightly reduce opacity for the disabled state */
  }

  /* Ensure the button appears enabled when it is actually enabled */
  .btn-custom:enabled {
    cursor: pointer; /* Pointer cursor when enabled */
  }

    .logo {
      display: block;
      margin: 0 auto 20px;
      width: 275px;
    }

    .logo-border {
      border-bottom: 1px solid #ddd;
      padding-bottom: 20px;
      margin-bottom: 20px;
    }

    .consent-text {
      font-size: 14px;
    }

    .form-container {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      margin: 0 auto;
    }

    .form-control {
      border-radius: 8px;
    }

    .mb-3 {
      margin-bottom: 20px;
    }

    .submit-btn {
      width: 100%;
    }

    /* Flexbox alignment for radio buttons */
    .form-check {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .form-check-input {
      width: 20px;
      height: 20px;
      margin-right: 10px;
    }

    .form-check label {
      font-size: 16px;
      margin-left: 10px;
      flex: 1;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 24px;
      }
    }

    .text-left {
      text-align: left;
    }

    /* Loading spinner styles */
    .spinner-border {
      width: 3rem;
      height: 3rem;
    }

    /* Success page styles with border */
    .success-container {
      text-align: left; /* Left-align success text */
      padding: 40px;
      border: 1px solid #ddd;
      border-radius: 10px;
      margin: 20px auto;
      max-width: 600px;
    }

    .success-container img {
      margin-bottom: 20px;
    }

    .separator {
      border-bottom: 1px solid #ddd;
      margin: 18px 0;
    }

    .address-container {
      position: relative;
    }

    .autocomplete-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 200px;
      overflow-y: auto;
      background-color: white;
      border: 1px solid #ccc;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none;
    }

    .suggestion-item {
      padding: 8px;
      cursor: pointer;
    }

    .suggestion-item:hover {
      background-color: #f0f0f0;
    }

  </style>
</head>
<body>
  <div class="container mt-5">
    <div class="form-container" id="form-container">
      <!-- Branding: Logo Image -->
      <img src="../assets/logo.svg" alt="Desert Oasis Healthcare Logo" class="logo logo-border">
      
      <h1 class="mb-4 text-left">Heart Health Monitoring Signup</h1>
      <p class="text-left">We appreciate your decision to take this proactive step with Desert Oasis Healthcare towards better heart health. To continue with your participation and receive the iRhythm Zio monitor by mail at no cost to you, please enter your information below.</p>

      <form id="infoForm" action="https://script.google.com/macros/s/AKfycbxixKXmbk3kN9gJd2GXFz2pgkNogZoMbKH_nshJ7WvzvyENEQKD1SBeUUlWZgcXDHf1/exec" method="POST" onsubmit="showLoadingState();">
        <!-- Hidden field for Response Id -->
        <input type="hidden" id="responseId" name="responseId" value="">
      
        <div class="mb-3">
          <label for="name" class="form-label">Name:</label>
          <input type="text" id="name" name="name" class="form-control" required>
        </div>
      
        <div class="mb-3 address-container">
          <label for="address" class="form-label">Address:</label>
          <input type="text" id="address" name="address" class="form-control" required />
          <div id="suggestions" class="autocomplete-suggestions"></div>
        </div>
        
        <!-- Additional Address Fields -->
        <div class="mb-3">
          <label for="city" class="form-label">City:</label>
          <input type="text" id="city" name="city" class="form-control" readonly />
        </div>
        
        <div class="mb-3">
          <label for="state" class="form-label">State:</label>
          <input type="text" id="state" name="state" class="form-control" readonly />
        </div>
        
        <div class="mb-3">
          <label for="postal_code" class="form-label">Postal Code:</label>
          <input type="text" id="postal_code" name="postal_code" class="form-control" readonly />
        </div>
        
        <div class="mb-3">
          <label for="country" class="form-label">Country:</label>
          <input type="text" id="country" name="country" class="form-control" readonly />
        </div>        
      
        <div class="mb-3">
          <label for="dob" class="form-label">Date of Birth:</label>
          <input type="date" id="dob" name="dob" class="form-control" required />
        </div>
      
        <div class="mb-3 consent-text text-left">

          <div class="separator"></div>
          
          <label for="consent" class="form-label">By submitting this form, I authorize Desert Oasis Healthcare to share and use my health information as necessary to coordinate and provide the Zio monitor service. I consent to be contacted by DOHC or iRhythm regarding this request by phone, email, or text, in accordance with HIPAA privacy rules.</label><br>
          
          <div class="separator"></div>
      
          <div class="form-check">
            <input type="radio" id="start" name="consent" value="I'm ready to get started" class="form-check-input" required>
            <label for="start" class="form-check-label">I'm ready to get started.</label>
          </div>
      
          <div class="form-check">
            <input type="radio" id="wait" name="consent" value="Wait - please have someone from DOHC contact me" class="form-check-input" required>
            <label for="wait" class="form-check-label">Wait - please have someone from DOHC contact me to answer my questions before sending the Zio monitor.</label>
          </div>
        </div>
      
        <button type="submit" class="btn btn-custom text-white submit-btn" id="submitBtn" disabled>Submit</button>
      </form>
      
      <!-- Loading State (Initially hidden) -->
      <div id="loadingState" class="text-center" style="display: none;">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <p>Please wait while we submit your information...</p>
      </div>
      
      <!-- Success Page (Initially hidden) -->
      <div id="successState" class="success-container" style="display: none;">
        <img src="../assets/logo.svg" alt="Desert Oasis Healthcare Logo" class="logo">
        <h2>Thank you for completing the Desert Oasis Heart Health Monitoring signup form with your information.</h2>
        <p>If you requested that someone from DOHC contact you regarding your questions before sending the Zio monitor, they will be in touch soon.</p>
        <p>If you indicated that you're ready to get started, iRhythm will send you a text message once the Zio monitor is shipped to the address you provided, and will follow up with a phone call when it is delivered to you. You can expect delivery of the Zio monitor in about one week.</p>
      </div>
            
      <!-- Loading State (Initially hidden) -->
      <div id="loadingState" class="text-center" style="display: none;">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <p>Please wait while we submit your information...</p>
      </div>
    </div>
  </div>

  <!-- Success Page (Initially hidden) -->
  <div id="successState" class="success-container" style="display: none;">
    <img src="../assets/logo.svg" alt="Desert Oasis Healthcare Logo" class="logo">
    <h2>Thank you for completing the Desert Oasis Heart Health Monitoring signup form with your information.</h2>
    <p>If you requested that someone from DOHC contact you regarding your questions before sending the Zio monitor, they will be in touch soon.</p>
    <p>If you indicated that you're ready to get started, iRhythm will send you a text message once the Zio monitor is shipped to the address you provided, and will follow up with a phone call when it is delivered to you. You can expect delivery of the Zio monitor in about one week.</p>
  </div>

  <!-- Bootstrap JS and Popper.js (optional for some components) -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

  <script>
    // Enable or disable submit button based on form validation
    const form = document.getElementById("infoForm");
    const submitBtn = document.getElementById("submitBtn");
  
    // Enable or disable submit button based on form validity
    form.addEventListener("input", function () {
      submitBtn.disabled = !form.checkValidity(); // Disable button if form is not valid
    });
  
    // Set the max date for Date of Birth input field to 18 years ago
    const dobField = document.getElementById("dob");
    const today = new Date();
    const eighteenYearsAgo = new Date(today.setFullYear(today.getFullYear() - 18));
    dobField.max = eighteenYearsAgo.toISOString().split("T")[0];
  
    // Show loading state when form is being submitted
    function showLoadingState() {
      document.getElementById("form-container").style.display = "none";
      document.getElementById("loadingState").style.display = "block";
    }
  
    // Show the success state after form submission
    function showSuccessState() {
      document.getElementById("loadingState").style.display = "none";
      document.getElementById("successState").style.display = "block";
    }
  
    // Ensure the form only handles POST request
    document.getElementById("infoForm").addEventListener("submit", function(event) {
      event.preventDefault(); // Prevent actual form submission for demo
      fetch('https://script.google.com/macros/s/AKfycbxixKXmbk3kN9gJd2GXFz2pgkNogZoMbKH_nshJ7WvzvyENEQKD1SBeUUlWZgcXDHf1/exec', {
        method: 'POST',
        body: new FormData(event.target)
      })
      .then(response => {
        if (response.ok) {
          showSuccessState();
        } else {
          alert("There was an issue with the submission.");
        }
      })
      .catch(error => {
        alert("There was an error submitting the form.");
      });
    });
  </script>  

<script>
  const apiKey = 'AIzaSyDUJf5RwRQeWlPhraU89seR4kHfUmaiJL0';

  // Initialize the Google Places Autocomplete
  async function initAutocomplete() {
    const input = document.getElementById('address');
    const suggestionsContainer = document.getElementById('suggestions');


    input.addEventListener('input', async () => {
      const query = input.value.trim();
      if (query.length > 2) {
        try {
          const predictions = await fetchAutocompleteSuggestions(query);
          displaySuggestions(predictions, suggestionsContainer, input);
        } catch (error) {
          console.error('Error fetching autocomplete suggestions:', error);
        }
      } else {
        suggestionsContainer.innerHTML = '';
      }
    });
  }

  async function fetchAutocompleteSuggestions(query) {
    const response = await fetch('https://places.googleapis.com/v1/places:autocomplete', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Goog-Api-Key': apiKey,
      },
      body: JSON.stringify({
        input: query,
        languageCode: 'en',
        includedRegionCodes: ['US'],
      }),
    });

    if (!response.ok) {
      throw new Error('Failed to fetch autocomplete suggestions');
    }

    const data = await response.json();
    return data.suggestions || [];
  }

  function displaySuggestions(suggestions, suggestionsContainer, input) {
    suggestionsContainer.innerHTML = '';
    suggestionsContainer.style.display = 'block';
    suggestions.forEach(suggestion => {
      const div = document.createElement('div');
      div.textContent = suggestion.placePrediction.text.text;
      div.classList.add('suggestion-item');
      div.addEventListener('click', () => {
        suggestionsContainer.style.display = 'hidden';
        input.value = suggestion.placePrediction.text.text;
        console.log(`suggestion.placePrediction`, suggestion.placePrediction)
        populateAddressFields(suggestion.placePrediction.placeId);
        suggestionsContainer.innerHTML = '';
      });
      suggestionsContainer.appendChild(div);
    });
  }

  async function populateAddressFields(placeId) {

    let placeDetails = await getPlaceDetails(placeId);

    const addressComponents = placeDetails.address_components;

    console.log(`addressComponents`, addressComponents);

    let city = '';
    let state = '';
    let postalCode = '';
    let country = '';

    addressComponents.forEach(component => {
      const componentType = component.types[0];
      switch (componentType) {
        case 'locality':
          city = component.long_name;
          break;
        case 'administrative_area_level_1':
          state = component.long_name;
          break;
        case 'postal_code':
          postalCode = component.long_name;
          break;
        case 'country':
          country = component.long_name;
          break;
      }
    });

    document.getElementById('city').value = city;
    document.getElementById('state').value = state;
    document.getElementById('postal_code').value = postalCode;
    document.getElementById('country').value = country;
  }

  async function getPlaceDetails(placeId) {
    // Use place ID to create a new Place instance.
    console.log(`google.maps`, google.maps);
    const { Place } = await google.maps.importLibrary("places");
    const place = new Place({
      id: placeId,
      requestedLanguage: "en", // optional
    });

    // Call fetchFields, passing the needed data fields.
    const r = await place.fetchFields({
      fields: ["addressComponents", "formattedAddress", "displayName"],
    });

    console.log(`r`, r);
    console.log(`place`, place)

    return place;
  }

  (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
    key: apiKey,
    libraries: "places",
    v: "weekly",
    // Use the 'v' parameter to indicate the version to use (weekly, beta, alpha, etc.).
    // Add other bootstrap parameters as needed, using camel case.
  });

  // Initialize the autocomplete functionality
  initAutocomplete();
</script>
  
</body>
</html>
